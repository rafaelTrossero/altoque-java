<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:adm="http://github.com/adminfaces"
                template="#{layoutMB.template}">

    <ui:define name="metadata">

        <ui:param name="renderFormAsterisks" value="true"/>
    </ui:define>
    <ui:define name="title">
        Asignar auto/s a Dirigente
    </ui:define>
    <ui:define name="body">

        <h:form id="form" prependId="false" >
            <p:focus context="@form"/>
            <p:panel styleClass="box-primary card">

                <div class="ui-g ui-fluid">
                    <div class="ui-sm-12 ui-g-6 ui-g-nopad"> 
                        <div class="ui-sm-12 ui-g-11">
                            <p:outputLabel for="somPastor" value="Dirigente"/>
                        </div>
                        <div class="ui-sm-12 ui-g-11" >
                            <p:selectOneMenu id="somPastor"
                                             converter="entityConverter"
                                             value="#{carListMB.pastorSelect}"
                                             >
                                <p:ajax listener="#{carListMB.recuperarAutos()}" update="@form, dtAgendaContactos"  event="change" />
                                <f:selectItem itemLabel="Seleccionar.." itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{votanteListMB.lstSIPastores}"/>
                            </p:selectOneMenu>
                        </div>
                    </div> 

                </div>
                <p:separator />
                <div class="ui-g ui-fluid">
                    <style type="text/css">
                        .old {
                            background-color: #3cbca7 !important;
                            background-image: none !important;
                            color: #000000 !important;
                        }
                    </style>
                    <p:dataTable id="dtAgendaContactos"
                                 rows="5"
                                 value="#{carListMB.lstPastorCar}"
                                 var="prod" 
                                 rendered="#{not empty carListMB.lstPastorCar}"
                                 emptyMessage="No hay autos vinculados al Dirigente"
                                   paginator="true"  paginatorPosition="bottom" 
                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {JumpToPageDropdown}"                                
                                 currentPageReportTemplate="Total: {totalRecords}"
                                 rowsPerPageTemplate="1,5,10,15,20,30"
                                 >
                        <f:facet name="header">
                            Autos vinculados al Dirigente #{carListMB.pastorSelect.apeNom}
                        </f:facet>
                        <p:column  headerText="Patente" filterBy="#{prod.patente}" filterMatchMode="contains" >

                            <h:outputText value="#{prod.patente}" />
                        </p:column>
                        <p:column  headerText="Marca" filterBy="#{prod.name}" filterMatchMode="contains">

                            <h:outputText value="#{prod.name}"/>

                        </p:column>
                        <p:column  headerText="Modelo" filterBy="#{prod.model}" filterMatchMode="contains" >

                            <h:outputText value="#{prod.model}"/>

                        </p:column>

                    </p:dataTable>
                </div> 





                <!-- <f:facet name="header">
                     <h:outputText value="Buscar persona para vincular con Dirigente"/>
                 </f:facet>-->
                <p:separator />
                <h:panelGroup id="panelBusqueda"  rendered="#{carListMB.panelBusqueda}">
                    <h3 style="margin-top:0">Buscar Auto</h3>
                    <h:panelGrid columns="6" style="margin-bottom:10px" cellpadding="5">
                        <p:outputLabel for="console" value="Criterio de Busqueda" />
                        <p:spacer width="25"/>
                        <p:selectOneRadio id="console" value="#{carListMB.criterioSeleccionado}" unselectable="false">
                            <f:selectItem itemLabel="Patente" itemValue="patente" />
                            <f:selectItem itemLabel="Marca" itemValue="marca" />
                            <f:selectItem itemLabel="Modelo" itemValue="modelo" />
                            <f:selectItem itemLabel="Todos" itemValue="todos" />
                        </p:selectOneRadio>

                        <p:inputText id="name" value="#{carListMB.criterioBusqueda}" 
                                     
                                     requiredMessage="Ingresar dato para buscar" 
                                     placeholder="Escribir...">

                        </p:inputText>
                        <p:message for="name"  display="icon" />
                        <p:commandButton  value="Buscar"
                                          process="@form" 
                                           validateClient="true"
                                          update="@form, singleDT" 
                                          actionListener="#{carListMB.buscarAutoPorCriterio()}" 
                                          icon="pi pi-check" />


                    </h:panelGrid>
                </h:panelGroup>

                <p:dataTable id="singleDT" var="car" value="#{carListMB.lstCars}" 
                             selectionMode="single" selection="#{carListMB.car}" rendered="#{not empty carListMB.lstCars}"
                             rowKey="#{car.id}" emptyMessage="No se encontraron autos por el criterio seleccionado"
                             paginator="true"  paginatorPosition="bottom"  
                             paginatorTemplate="{CurrentPageReport} {PreviousPageLink} {PageLinks} {NextPageLink}"                                 
                             currentPageReportTemplate="Registros encontrados: {totalRecords}">
                    <p:ajax event="rowSelect" listener="#{carListMB.onRowSelect}" update="fab"/>
                    <p:ajax event="rowUnselect" listener="#{carListMB.onRowUnselect}"  update="fab" />
                    <f:facet name="header">
                        Encontrados
                    </f:facet>
                    <p:column headerText="Patente">
                        <h:outputText value="#{car.patente}" />
                    </p:column>
                    <p:column headerText="Marca">
                        <h:outputText value="#{car.name}" />
                    </p:column>
                    <p:column headerText="Modelo">
                        <h:outputText value="#{car.model}" />
                    </p:column>

                    <!-- 
                    <f:facet name="footer">

                        <div id="main-buttons" class="hidden-sm hidden-xs">
                            <p:commandButton id="botonAdd"  value="Agregar" disabled="#{carListMB.dtAutosVinculados}" action="#{carListMB.vincularAutoDirigente()}" update="@form, dtAgendaContactos "
                                             icon="fa fa-refresh" styleClass="btn-primary"/>
                            <p:spacer width="25" />
                            <p:commandButton value="Vincular" action="#{carListMB.confirmarVinculacionAutoDirigente()}" process="@this"
                                             icon="fa fa-check" styleClass="btn-success"
                                             update="@form, dtAgendaContactos"  resetValues="true"/>

                            <p:spacer width="25"/>
                            <p:commandButton value="Cancelar" immediate="true"
                                             action="/index?faces-redirect=true"
                                             process="@this"
                                             icon="fa fa-reply"/>
                        </div>
                    </f:facet>
                    -->

                </p:dataTable>

                <h:panelGroup id="fab" >


                    <p:stack icon="../resources/images/optionTrans.png" expanded="true" id="stack"
                             openSpeed="500" rendered="#{not empty carListMB.lstCars}" >

                        <p:menuitem value="Vincular" disabled="#{carListMB.btVincular}"  
                                    id="botonVincular"  onclick="javascript:window.location = '#somPastor'"
                                    icon="../resources/images/vincular.png"   update="dtAgendaContactos"
                                    action="#{carListMB.confirmarVinculacionAutoDirigente()}"  

                                    process="@this" >
                        </p:menuitem>  

                        <p:menuitem  value="Agregar"  id="botonAdd2" disabled="#{carListMB.dtAutosVinculados}"
                                     icon="../resources/images/add.png" 
                                     action="#{carListMB.vincularAutoDirigente()}"
                                     update="@form, dtAgendaContactos, stack"

                                     process="@this" >
                        </p:menuitem>  

                    </p:stack>

                </h:panelGroup>







            </p:panel>
            <p:separator />



        </h:form>


    </ui:define>

</ui:composition>
