<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:adm="http://github.com/adminfaces"
                template="#{layoutMB.template}">

    <ui:define name="metadata">

        <ui:param name="renderFormAsterisks" value="true"/>
    </ui:define>
    <ui:define name="title">
        Asignar votantes a Dirigente
    </ui:define>
    <ui:define name="body">

        <h:form id="form" prependId="false" >
            <p:focus context="@form"/>
            <p:panel styleClass="box-primary card">

                <div class="ui-g ui-fluid">
                    <div class="ui-sm-12 ui-g-6 ui-g-nopad"> 
                        <div class="ui-sm-12 ui-g-11">
                            <p:outputLabel for="somPastor" value="Dirigente"/>
                        </div>
                        <div class="ui-sm-12 ui-g-11" >
                            <p:selectOneMenu id="somPastor"
                                             converter="entityConverter"
                                             value="#{votanteListMB.pastorSelect}"
                                             >
                                <p:ajax listener="#{votanteListMB.recuperarVotantes}" update="@form, dtAgendaContactos"  event="change" />
                                <f:selectItem itemLabel="Seleccionar.." itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{votanteListMB.lstSIPastores}"/>
                            </p:selectOneMenu>
                        </div>
                    </div> 

                </div>
                <!-- Combo Autos -->

                <div class="ui-g ui-fluid">
                    <div class="ui-sm-12 ui-g-6 ui-g-nopad"> 
                        <div class="ui-sm-12 ui-g-11">
                            <p:outputLabel for="somAutos" value="Auto"/>
                        </div>
                        <div class="ui-sm-12 ui-g-11" >
                            <p:selectOneMenu id="somAutos"
                                             converter="entityConverter"
                                             value="#{votanteListMB.autoSelect}"
                                             >
                                <!--   <p:ajax listener="#/{votanteListMB.recuperarVotantes}" update="@form, dtAgendaContactos"  event="change" />-->
                                <f:selectItem itemLabel="Seleccionar.." itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{votanteListMB.lstSIAutos}"/>
                            </p:selectOneMenu>
                        </div>
                    </div> 

                </div>

                <!-- Fin Combo Autos -->

                <p:separator />
                <div class="ui-g ui-fluid">
                    <style type="text/css">
                        .validate {
                            background-color: #67e096 !important;
                            background-image: none !important;
                            color: #000000 !important;
                        }

                    </style>
                    <p:dataTable id="dtAgendaContactos"
                                 rows="5" 
                                 editMode="cell"
                                 rowStyleClass="#{prod.asistio eq true ? 'validate' : null}"
                                 value="#{votanteListMB.lstVotantePastor}"
                                 var="prod" rendered="#{not empty votanteListMB.lstVotantePastor}"
                                 emptyMessage="No hay votantes vinculados al Dirigente"
                                 paginator="true"  paginatorPosition="bottom" 
                                 editable="true" 
                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {JumpToPageDropdown}"                                
                                 currentPageReportTemplate="Total: {totalRecords}"
                                 rowsPerPageTemplate="1,5,10,15,20,30">

                        <f:facet name="header">

                            Votantes vinculados al Dirigente #{votanteListMB.pastorSelect.apeNom}
                            <p:button target="_blank" href="#{votanteListMB.linkWhatsapp}" style="background-color: #25d366" icon="fa fa-whatsapp" title="Escribir Whatsapp" />
                        </f:facet>

                        <p:ajax event="rowEdit" listener="#{votanteListMB.onRowEdit}" />
                        <p:ajax event="rowEditCancel" listener="#{votanteListMB.onRowCancel}"  />

                        <p:column  headerText="Apellido y Nombre" filterBy="#{prod.apenom}" filterMatchMode="contains" sortBy="#{prod.apenom}" >

                            <h:outputText value="#{prod.apenom}"  />
                        </p:column>
                        <p:column  headerText="DNI" filterBy="#{prod.dni}" >

                            <h:outputText value="#{prod.dni}"/>

                        </p:column>
                        <p:column  headerText="Orden" >

                            <h:outputText value="#{prod.orden}"/>

                        </p:column>
                        <p:column  headerText="Mesa" filterBy="#{prod.mesa}"  sortBy="#{prod.mesa}"  >

                            <h:outputText value="#{prod.mesa}"/>

                        </p:column>

                        <p:column  headerText="Vehículo Asignado" filterBy="#{prod.car.model}"  sortBy="#{prod.car.model}"  >

                            <h:outputText value="#{prod.car.name} #{prod.car.model}"/>

                        </p:column>

                        <p:column  headerText="Teléfono" filterBy="#{prod.telefono}"  sortBy="#{prod.telefono}"  >
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{prod.telefono}"/></f:facet>
                                <f:facet name="input"><p:inputText value="#{prod.telefono}" style="width:100%" label="Telefono" placeholder="ingrese teléfono"/></f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column  headerText="Asistió"  sortBy="#{prod.asistio}" >

                            <h:outputText value="#{prod.asistio  ? 'Si' : 'No'}"/>

                        </p:column>

                    </p:dataTable>
                </div> 





                <!-- <f:facet name="header">
                     <h:outputText value="Buscar persona para vincular con Dirigente"/>
                 </f:facet>-->
                <p:separator />
                <h:panelGroup id="panelBusqueda"  rendered="#{votanteListMB.panelBusqueda}">
                    <h3 style="margin-top:0">Buscar Persona</h3>
                    <h:panelGrid columns="6" style="margin-bottom:10px" cellpadding="5">
                        <p:outputLabel for="console" value="Criterio de Busqueda" />
                        <p:selectOneRadio id="console" value="#{votanteListMB.criterioSeleccionado}"  unselectable="false">
                            <f:selectItem itemLabel="DNI" itemValue="dni"  />
                            <f:selectItem itemLabel="Apellido y Nombre" itemValue="apenom" />
                            <f:selectItem itemLabel="Orden" itemValue="orden" />
                        </p:selectOneRadio>

                        <p:inputText id="name" value="#{votanteListMB.criterioBusqueda}" 
                                     required="true"  
                                     requiredMessage="Ingresar dato para buscar" 
                                     placeholder="Escribir...">

                        </p:inputText>
                        <p:message for="name"  display="icon" />
                        <p:commandButton  value="Buscar" process="@form" 
                                          update="@form, singleDT" 
                                           validateClient="true"
                                          actionListener="#{votanteListMB.buscarVotantePorCriterio()}" 
                                          icon="pi pi-check" />


                    </h:panelGrid>
                </h:panelGroup>

                <style type="text/css">
                    .vinculado {
                        background-color: #e06767 !important;
                        background-image: none !important;
                        color: #000000 !important;
                    }

                </style>
                <p:dataTable id="singleDT" var="vot" value="#{votanteListMB.lstVotantes}" 
                             selectionMode="single" selection="#{votanteListMB.votador}" rendered="#{not empty votanteListMB.lstVotantes}"
                             rowStyleClass="#{vot.vinculado eq true ? 'vinculado' : null}"
                             disabledSelection="#{vot.vinculado}"
                             rowKey="#{vot.id}" emptyMessage="No se encontraron personas por el criterio seleccionado"
                             paginator="true"  paginatorPosition="bottom" 
                             paginatorTemplate="{CurrentPageReport} {PreviousPageLink} {PageLinks} {NextPageLink}"                                 
                             currentPageReportTemplate="Registros encontrados: {totalRecords}">
                    <p:ajax event="rowSelect" listener="#{votanteListMB.onRowSelect}" update="fab"/>
                    <p:ajax event="rowUnselect" listener="#{votanteListMB.onRowUnselect}"  update="fab" />
                    <f:facet name="header">
                        Encontrados
                    </f:facet>
                    <p:column headerText="Orden">
                        <h:outputText value="#{vot.orden}" />
                    </p:column>
                    <p:column headerText="Apellido y Nombre" filterBy="#{vot.apenom}" filterMatchMode="contains" sortBy="#{vot.apenom}">
                        <h:outputText value="#{vot.apenom}" />
                    </p:column>
                    <p:column headerText="DNI" filterBy="#{vot.dni}" filterMatchMode="contains" sortBy="#{vot.dni}">
                        <h:outputText value="#{vot.dni}" />
                    </p:column>

                    <!-- 
                    <f:facet name="footer">

                        <div id="main-buttons" class="hidden-sm hidden-xs">
                            <p:commandButton id="botonAdd"  value="Agregar" disabled="#{votanteListMB.dtVotantesVinculados}" action="#{votanteListMB.vincularVotadorDirigente()}" update="@form, dtAgendaContactos "
                                             icon="fa fa-refresh" styleClass="btn-primary"/>
                            <p:spacer width="25" />
                            <p:commandButton value="Vincular" action="#{votanteListMB.confirmarVinculacionVotadorDirigente()}" process="@this"
                                             icon="fa fa-check" styleClass="btn-success"
                                             update="@form, dtAgendaContactos"  resetValues="true"/>

                            <p:spacer width="25"/>
                            <p:commandButton value="Cancelar" immediate="true"
                                             action="/index?faces-redirect=true"
                                             process="@this"
                                             icon="fa fa-reply"/>
                        </div>
                    </f:facet>
                    -->
                </p:dataTable>
                <h:panelGroup id="fab" >


                    <p:stack icon="../resources/images/optionTrans.png" expanded="true" id="stack"
                             openSpeed="500" rendered="#{not empty votanteListMB.lstVotantes}" >

                        <p:menuitem value="Vincular" disabled="#{votanteListMB.btVincular}"  
                                    id="botonVincular" 
                                    icon="../resources/images/vincular.png"   update="@form, dtAgendaContactos"
                                     action="#{votanteListMB.confirmarVinculacionVotadorDirigente()}"  

                                    process="@this" >
                        </p:menuitem>  

                        <p:menuitem  value="Agregar"  id="botonAdd2" disabled="#{votanteListMB.dtVotantesVinculados}"
                                     icon="../resources/images/add.png" 
                                     action="#{votanteListMB.vincularVotadorDirigente()}"
                                     update=" @form, dtAgendaContactos, stack"

                                     process="@this" >
                        </p:menuitem>  

                    </p:stack>

                </h:panelGroup>






            </p:panel>
            <p:separator />



        </h:form>


    </ui:define>

</ui:composition>

