<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:adm="http://github.com/adminfaces"

                xmlns:pe="http://primefaces.org/ui/extensions"
                template="#{layoutMB.template}">

    <ui:define name="metadata">

        <ui:param name="renderFormAsterisks" value="true"/>
    </ui:define>
    <ui:define name="title">
        Asignar Votantes a un Vehiculo
    </ui:define>
    <ui:define name="body">

        <h:form id="form" prependId="false" >
            <p:focus context="@form"/>
            <p:panel styleClass="box-primary card">

                <!-- Combo Autos -->

                <div id="som" class="ui-g ui-fluid">
                    <div class="ui-sm-12 ui-g-6 ui-g-nopad"> 
                        <div class="ui-sm-12 ui-g-11">
                            <p:outputLabel for="somAutos" value="Auto"/>
                        </div>
                        <div class="ui-sm-12 ui-g-11" >
                            <p:selectOneMenu id="somAutos"
                                             filter="true" filterMatchMode="contains"
                                             converter="entityConverter"
                                             value="#{votanteListMB.autoSelect}"
                                             >
                                <p:ajax listener="#{votanteListMB.recuperarVotantesAuto()}" update="@form, dtAgendaContactos, panelBusqueda"  event="change" />
                                <f:selectItem itemLabel="Seleccionar.." itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{votanteListMB.lstSIAutos}"/>
                            </p:selectOneMenu>
                        </div>
                    </div> 

                </div>

                <!-- Fin Combo Autos -->

                <p:separator />
                <div class="ui-g ui-fluid">
                    <style type="text/css">
                        .old {
                            background-color: #3cbca7 !important;
                            background-image: none !important;
                            color: #000000 !important;
                        }
                    </style>
                    <p:dataTable id="dtAgendaContactos"
                                 rows="5"
                                 editable="true"
                                 editMode="cell"
                                 value="#{votanteListMB.lstVotantesAuto}"
                                 var="prod" 
                                 rendered="#{not empty votanteListMB.lstVotantesAuto}"
                                 emptyMessage="No hay votantes vinculados al Auto"
                                 paginator="true"  paginatorPosition="bottom" 
                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {JumpToPageDropdown}"                                
                                 currentPageReportTemplate="Total: {totalRecords}"
                                 rowsPerPageTemplate="1,5,10,15,20,30"
                                 >
                        <f:facet name="header">
                            Votantes vinculados al Auto #{votanteListMB.autoSelect.name} #{votanteListMB.autoSelect.model}
                            Chofer: #{votanteListMB.autoSelect.nombre_chofer}, Telefono: #{votanteListMB.autoSelect.telefono_chofer}
                        </f:facet>
                        <p:column  headerText="Nombre y Apellido" filterBy="#{prod.apenom}" filterMatchMode="contains"  >

                            <h:outputText value="#{prod.apenom}" />
                        </p:column>
                        <p:column  headerText="DNI" filterBy="#{prod.dni}" filterMatchMode="contains"  >

                            <h:outputText value="#{prod.dni}"/>

                        </p:column>
                        <p:column  headerText="Teléfono" filterBy="#{prod.telefono}"  sortBy="#{prod.telefono}"  >
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{prod.telefono}"/></f:facet>
                                <f:facet name="input"><p:inputText value="#{prod.telefono}" style="width:100%" label="Telefono" placeholder="ingrese teléfono"/></f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column  headerText="Asistió ?" >

                            <h:outputText value="#{prod.asistio  ? 'Si' : 'No'}"/>

                        </p:column>

                    </p:dataTable>
                </div> 





                <!-- <f:facet name="header">
                     <h:outputText value="Buscar persona para vincular con Dirigente"/>
                 </f:facet>-->
                <p:separator />

                <h:panelGroup id="panelBusqueda"  rendered="#{votanteListMB.panelBusqueda}">
                    <h3 style="margin-top:0">Buscar Persona</h3>
                    <h:panelGrid  columns="6" style="margin-bottom:10px" cellpadding="5">
                        <p:outputLabel for="console" value="Criterio de Busqueda" />
                        <p:selectOneRadio id="console" value="#{votanteListMB.criterioSeleccionado}" 

                                          unselectable="false">
                            <f:selectItem itemLabel="DNI" itemValue="dni"  />
                            <f:selectItem itemLabel="Apellido y Nombre" itemValue="apenom" />
                            <f:selectItem itemLabel="Orden" itemValue="orden" />

                        </p:selectOneRadio>

                        <p:inputText id="name" required="true"  
                                     requiredMessage="Ingresar dato para buscar" 

                                     value="#{votanteListMB.criterioBusqueda}" placeholder="Escribir...">

                        </p:inputText>
                        <p:message for="name"  display="icon" />
                        <p:commandButton  value="Buscar" 
                                          process="@form" 
                                          validateClient="true"
                                          update="@form, singleDT" 
                                          actionListener="#{votanteListMB.buscarVotantePorCriterio()}" 
                                          icon="pi pi-check" >
                        </p:commandButton>


                    </h:panelGrid>
                </h:panelGroup>

                <style type="text/css">
                    .vinculado {
                        background-color: #e06767 !important;
                        background-image: none !important;
                        color: #000000 !important;
                    }

                </style>
                <p:dataTable id="singleDT" var="vot" value="#{votanteListMB.lstVotantes}" 
                             selectionMode="single" selection="#{votanteListMB.votador}" rendered="#{not empty votanteListMB.lstVotantes}"
                             rowStyleClass="#{vot.car ne null ? 'vinculado' : null}"
                             disabledSelection="#{vot.vinculado}"
                             rowKey="#{vot.id}" emptyMessage="No se encontraron personas por el criterio seleccionado"
                             paginator="true"  paginatorPosition="bottom" 
                             paginatorTemplate="{CurrentPageReport} {PreviousPageLink} {PageLinks} {NextPageLink}"                                 
                             currentPageReportTemplate="Registros encontrados: {totalRecords}">
                    <p:ajax event="rowSelect" listener="#{votanteListMB.onRowSelect}" update="fab"/>
                    <p:ajax event="rowUnselect" listener="#{votanteListMB.onRowUnselect}"  update="fab" />
                    <f:facet name="header">
                        Encontrados
                    </f:facet>
                    <p:column headerText="Orden">
                        <h:outputText value="#{vot.orden}" />
                    </p:column>
                    <p:column headerText="Apellido y Nombre" filterBy="#{vot.apenom}" filterMatchMode="contains" sortBy="#{vot.apenom}">
                        <h:outputText value="#{vot.apenom}" />
                    </p:column>
                    <p:column headerText="DNI" filterBy="#{vot.dni}" filterMatchMode="contains" sortBy="#{vot.dni}">
                        <h:outputText value="#{vot.dni}" />
                    </p:column>

                    <!--
                   <p:column  width="50">
                       <p:commandButton  id="botonAddDT" action="#{votanteListMB.vincularVotadorAuto()}" update="@form, dtAgendaContactos "
                                        icon="fa fa-plus" styleClass="btn-primary">
                           <f:setPropertyActionListener value="#{vot}" target="#{votanteListMB.votador}" />
                       </p:commandButton>
                   </p:column> -->
                    <!--
                                        <f:facet name="footer">
                    
                                            <div id="main-buttons" class="hidden-sm hidden-xs">
                                                <p:commandButton id="botonAdd"  value="Agregar" disabled="#{votanteListMB.dtVotantesVinculados}" action="#{votanteListMB.vincularVotadorAuto()}" update="@form, dtAgendaContactos "
                                                                 icon="fa fa-refresh" styleClass="btn-primary"/>
                                                <p:spacer width="25" />
                                                <p:commandButton value="Vincular" action="#{votanteListMB.confirmarVinculacionVotadorAuto()}" process="@this"
                                                                 icon="fa fa-check" styleClass="btn-success"
                                                                 update="@form, dtAgendaContactos"  resetValues="true"/>
                    
                                                <p:spacer width="25"/>
                                                <p:commandButton value="Cancelar" immediate="true"
                                                                 action="/index?faces-redirect=true"
                                                                 process="@this"
                                                                 icon="fa fa-reply"/>
                                            </div>
                                        </f:facet>
                    -->
                </p:dataTable>

                <h:panelGroup id="fab" >


                    <p:stack icon="../resources/images/optionTrans.png" expanded="true" id="stack"
                             openSpeed="500" rendered="#{not empty votanteListMB.lstVotantes}" >

                        <p:menuitem value="Vincular" disabled="#{votanteListMB.btVincular}"  
                                    id="botonVincular"  onclick="javascript:window.location = '#som'"
                                    icon="../resources/images/vincular.png"   update="@form, dtAgendaContactos"
                                    action="#{votanteListMB.confirmarVinculacionVotadorAuto()}"  

                                    process="@this" >
                        </p:menuitem>  

                        <p:menuitem  value="Agregar"  id="botonAdd2" disabled="#{votanteListMB.dtVotantesVinculados}"
                                     icon="../resources/images/add.png" 
                                     action="#{votanteListMB.vincularVotadorAuto()}" 
                                     update=" @form, dtAgendaContactos"

                                     process="@this" >
                        </p:menuitem>  

                    </p:stack>

                </h:panelGroup>
            </p:panel>
            <p:separator />



        </h:form>


    </ui:define>

</ui:composition>

